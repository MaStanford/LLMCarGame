# The Genesis Module

```
    ___________  ____________   _____________ _______ _____ _____
   /_  __/ __/ / / / __/ ___/  / ___/ __/ |/ / __/ __/  _/ __/ /
    / / / _// /_/ / _// (_ /  / (_ / _//    / _/_\ \_/ /_\ \  ___
   /_/ /___/\____/___/\___/   \___/___/_/|_/___/___/___/___/ /_/

            A Terminal-Based Automotive RPG
              _______________
             //             \\
            //               \\
      _____//_________________\\______
     |  _  |||  _  ||  _  ||  _  |   |
     |_/ \_|||_/ \_||_/ \_||_/ \_|___|
      |_____|        |_____|
```

A terminal-based, open-world, automotive RPG survival game. Drive, fight,
loot, and survive in a procedurally generated wasteland controlled by rival
factions. Every playthrough is unique -- the world's theme, factions, and
quests are generated by a Large Language Model.

---

## Table of Contents

- [Features](#features)
- [Gameplay Overview](#gameplay-overview)
- [Installation](#installation)
- [Running the Game](#running-the-game)
- [Controls](#controls)
- [World Generation Modes](#world-generation-modes)
- [Troubleshooting](#troubleshooting)

---

## Features

- **Infinite Procedural World** -- An endlessly generated map of roads,
  cities, and wilderness. No two playthroughs are the same.
- **Faction Warfare** -- Six rival factions carve up the wasteland, each
  with unique units, a boss leader, and inter-faction relationships.
  Align with one, play them against each other, or go rogue. Your actions
  shift territorial control, reputation, and patrol strength. Rival
  faction enemies will fight each other when they meet in the wilderness.
- **Faction Conquest** -- Push a faction's control low enough and a
  decisive battle quest becomes available. Defeat their boss to conquer
  their territory permanently.
- **Vehicles** -- A roster of cars including hatchbacks, sports cars,
  sedans, trucks, vans, motorcycles, hot rods, and panel wagons, each
  with unique stats, weight, and attachment points.
- **Weapons and Equipment** -- Mount weapons (pistols, LMGs, HMGs,
  shotguns, flamethrowers, mine launchers) to your car's hardpoints.
  Equip passive gear (armor, engine upgrades, tires, accessories) for
  stat bonuses. Items come in rarity tiers: common, uncommon, rare,
  epic, legendary, and godly, with random modifiers.
- **Cities** -- Procedurally generated with gas stations, mechanic shops,
  weapon shops, and a city hall for faction quests. Cities controlled by
  hostile factions deploy defense turrets against you.
- **Building Destruction** -- Ram or shoot buildings to damage and destroy
  them. Destroying buildings drops loot and XP but causes faction
  reputation loss. Destroy enough and the faction sends a retaliation
  wave -- destroy more and their boss comes for you.
- **Boss Fights** -- Each faction has a boss leader in a unique vehicle.
  Bosses are triggered by extreme negative reputation or by the conquest
  quest chain. Turn-based boss combat with attack, defend, evade, and
  flee options.
- **Combat and Loot** -- Fight bandits, hostile vehicles, and wildlife.
  Defeated enemies drop weapons, equipment, ammo, and cash. Enemies
  from rival factions fight each other in contested territory.
- **XP and Leveling** -- Earn experience from kills and destruction.
  Level up to 50, gaining 5% stat bonuses per level across speed,
  durability, handling, and damage.
- **Difficulty Modes** -- Four difficulty levels (Easy, Normal, Hard,
  Very Hard) that affect enemy health, damage, spawn rates, aim
  accuracy, and aggression.
- **Resource Management** -- Manage durability, fuel, ammo, and cash.
  Repair at mechanics, refuel at gas stations, rearm at weapon shops.
- **Salvage System** -- Break down unwanted gear into scrap, a secondary
  currency.
- **Quest System** -- Six quest types: convoy raids, assassinations,
  outpost defense, convoy escort, wave assaults, and courier runs.
  Quests can chain into follow-up missions. Take up to three quests
  at once.
- **Karma System** -- Actions affect your karma. Killing wildlife lowers
  it, influencing the world's response to you.
- **Save and Load** -- Save your progress and resume later from the
  pause menu.
- **Fast Travel** -- Travel instantly between visited cities from the
  map screen.
- **Story Journal** -- A running chronicle of your actions and events,
  accessible any time.
- **LLM-Powered Narrative** -- The game's story, theme, factions, and
  quests are generated fresh each playthrough by a language model. Play
  offline with a local model or online with Gemini or Claude CLI for
  faster generation. Players choose from three LLM-generated themes
  before each playthrough begins.

---

## Gameplay Overview

You start in **The Junction**, a neutral hub city at the center of the
map. From there, drive out into the wasteland to explore, fight, and
build your reputation.

The world is divided into territories controlled by six factions, each
with their own units, relationships, and a boss leader. Factions can be
hostile, neutral, or allied to each other. As you complete quests for a
faction, your reputation with them rises (and drops with their rivals).

**General progression:**

1. Start at The Junction. Pick up quests from the city hall.
2. Drive into the wilderness. Fight enemies, collect loot, and earn XP.
3. Visit other faction cities. Trade at shops, take on new quests.
4. Build reputation with factions you want to ally with. Destroy
   buildings or attack patrols of factions you want to antagonize.
5. As faction control drops, conquest quests become available. Defeat
   the faction boss to take over their territory.
6. Hostile cities deploy defense turrets and increased patrols against
   you. Manage your reputation carefully or be prepared for a fight.
7. Level up your car with better weapons, equipment, and stat bonuses.

---

## Installation

### Prerequisites

- **Python 3.10+**
- **pip**
- A terminal with Unicode support (most modern terminals work)

### Quick Install

Clone the repository, then run the installer for your platform:

**macOS / Linux:**

```bash
git clone https://github.com/MaStanford/LLMCarGame.git
cd LLMCarGame
chmod +x install.sh
./install.sh
```

**Windows:**

```
git clone https://github.com/MaStanford/LLMCarGame.git
cd LLMCarGame
install.bat
```

The installer will:

1. Check for Python and pip
2. Create a virtual environment
3. Install all dependencies
4. Build `llama-cpp-python` with GPU acceleration if available
   (Metal on macOS, CUDA on Linux/Windows with NVIDIA GPU)
5. Optionally download the local AI model (~2.5GB for the small model,
   ~5GB for the large model)

If you skipped the model download during install, you can run it later:

```bash
python3 download_model.py
```

---

## Running the Game

**macOS / Linux:**

```bash
./run_game.sh
```

**Windows:**

```
run_game.bat
```

Optional flags:

- `--dev` -- Enable Textual developer mode
- `--log` -- Enable file logging

On macOS/Linux, pass flags after the script name:
`./run_game.sh --dev --log`

---

## Controls

### Driving

| Key           | Action                          |
| ------------- | ------------------------------- |
| `W`           | Accelerate                      |
| `S`           | Brake / Reverse                 |
| `A`           | Turn left                       |
| `D`           | Turn right                      |
| `Left Arrow`  | Aim weapons left                |
| `Right Arrow` | Aim weapons right               |
| `Space`       | Fire weapons                    |
| `1`-`9`       | Toggle individual weapon mounts |

### Menus and Screens

| Key           | Action                      |
| ------------- | --------------------------- |
| `I`           | Open inventory              |
| `M`           | Open map                    |
| `F`           | Open faction command screen |
| `Q`           | Open quest log              |
| `J`           | Open story journal          |
| `Tab`         | Cycle active quest tracking |
| `Esc`         | Pause menu                  |
| `Enter`       | Open notification log       |
| `` ` `` / `~` | Debug console (dev mode)    |

### Inventory Screen

| Key              | Action                                        |
| ---------------- | --------------------------------------------- |
| `Up` / `Down`    | Navigate items                                |
| `Left` / `Right` | Switch pane (Inventory / Loadout / Equipment) |
| `Enter`          | Equip or select item                          |
| `S`              | Salvage item for scrap                        |
| `A` / `D`        | Rotate car preview                            |
| `Esc`            | Back                                          |

### Shop Screen

| Key                | Action                                 |
| ------------------ | -------------------------------------- |
| `Up` / `Down`      | Navigate items                         |
| `Shift+Up` / `Down`| Scroll item list quickly               |
| `Left` / `Right`   | Switch between shop and your inventory |
| `Enter`            | Buy or sell selected item              |
| `Esc`              | Leave shop                             |

### Map Screen

| Key            | Action                                  |
| -------------- | --------------------------------------- |
| `W`/`A`/`S`/`D`| Navigate between map nodes             |
| `Arrow Keys`   | Scroll map freely                      |
| `M`            | Toggle world map / city map            |
| `C`            | Center on player                       |
| `F`            | Fast travel to selected visited city   |
| `Enter`        | Set waypoint to selected node          |
| `Esc`          | Close map                              |

### Buildings

Drive slowly into a building to enter it. The car auto-stops on contact.
Gas stations, mechanic shops, weapon shops, and city halls are all entered
this way.

---

## World Generation Modes

The game offers two engine modes for generating its narrative content.
Switch between them in the **Settings** menu.

### Local Mode (Default)

Uses a local LLM (Qwen3) running on your machine.

- Fully offline after initial model download
- Generation speed depends on your hardware (can be slow on older machines)
- Two model sizes available:
  - **Small** (Qwen3-4B, ~2.5GB) -- faster, lower quality
  - **Large** (Qwen3-8B, ~5GB) -- slower, higher quality
- Download via `python3 download_model.py` and select the model size
  in Settings

### Command Line Mode

Uses a cloud LLM via a CLI tool. Two providers are supported:

#### Gemini CLI (Google)

- Fast generation (usually under 30 seconds)
- Higher quality narrative output
- Requires internet access and Gemini CLI setup

**Option 1: User Authentication (recommended)**

1. Install the Gemini CLI per the
   [official instructions](https://ai.google.dev/tutorials/gemini_cli_quickstart)
2. Authenticate:

   ```bash
   gemini auth
   ```

**Option 2: API Key**

1. Get an API key from [Google AI Studio](https://aistudio.google.com/)
2. Set the environment variable:
   - macOS / Linux: `export GEMINI_API_KEY="YOUR_KEY"`
   - Windows: `set GEMINI_API_KEY="YOUR_KEY"`

#### Claude CLI (Anthropic)

- High quality narrative output
- Requires internet access and Claude CLI setup
- Install the Claude CLI and authenticate, then select "Anthropic Claude"
  as the CLI provider in Settings

After setting up your preferred CLI tool, launch the game, go to
**Settings**, set the engine to "Command Line", and choose your
CLI provider.

---

## Troubleshooting

### Python not found

```
ERROR: python3 is not installed or not in PATH.
```

Install Python 3.10 or later:

| Platform         | Command                                                                                     |
| ---------------- | ------------------------------------------------------------------------------------------- |
| macOS (Homebrew) | `brew install python3`                                                                      |
| macOS (Xcode)    | `xcode-select --install`                                                                    |
| Debian / Ubuntu  | `sudo apt install python3 python3-pip python3-venv`                                         |
| Fedora           | `sudo dnf install python3 python3-pip`                                                      |
| Arch             | `sudo pacman -S python python-pip`                                                          |
| Windows          | Download from [python.org](https://www.python.org/downloads/) -- check "Add Python to PATH" |
| Windows (winget) | `winget install Python.Python.3.12`                                                         |

### pip not found

```
ERROR: pip is not available for python3.
```

- macOS: `python3 -m ensurepip --upgrade`
- Debian/Ubuntu: `sudo apt install python3-pip`
- Windows: Reinstall Python with "pip" checked, or run
  `python3 -m ensurepip --upgrade`

### Virtual environment creation fails

```
ERROR: Failed to create virtual environment.
```

On Debian/Ubuntu, install the venv module:

```bash
sudo apt install python3-venv
```

### llama-cpp-python build fails

This package compiles C++ code and can fail if build tools are missing.

**macOS:**

```bash
xcode-select --install
```

**Debian / Ubuntu:**

```bash
sudo apt install build-essential cmake
```

**Windows:**

Install [Visual Studio Build Tools](https://visualstudio.microsoft.com/visual-cpp-build-tools/)
with the "Desktop development with C++" workload.

**CUDA build fails on Linux/Windows:**

If you have an NVIDIA GPU but the CUDA build fails, install the CUDA
toolkit:

- Linux: `sudo apt install nvidia-cuda-toolkit`
- Windows: Download from
  [NVIDIA CUDA Downloads](https://developer.nvidia.com/cuda-downloads)

The installer will automatically fall back to a CPU-only build if CUDA
compilation fails. The game will still work, but local AI generation
will be slower.

### Terminal rendering issues

- Use a terminal that supports Unicode and 256+ colors
- Recommended: iTerm2 (macOS), Windows Terminal (Windows),
  Alacritty, Kitty, or any modern terminal emulator
- Avoid older terminals like the default macOS Terminal.app or cmd.exe
- If colors look wrong, ensure your terminal's color scheme uses a dark
  background

### Game crashes on startup with `ModuleNotFoundError`

Make sure you ran the installer first:

- macOS / Linux: `./install.sh`
- Windows: `install.bat`

If you installed dependencies manually, ensure you activated the virtual
environment before running the game:

```bash
source venv/bin/activate   # macOS / Linux
venv\Scripts\activate.bat  # Windows
```

### Linux audio library error

If you see errors related to `libstdc++` on Linux, the run script
handles this automatically. If running manually, set:

```bash
export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libstdc++.so.6
python3 -m car
```
