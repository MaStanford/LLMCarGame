# The Genesis Module

```
    ___________  ____________   _____________ _______ _____ _____
   /_  __/ __/ / / / __/ ___/  / ___/ __/ |/ / __/ __/  _/ __/ /
    / / / _// /_/ / _// (_ /  / (_ / _//    / _/_\ \_/ /_\ \  ___
   /_/ /___/\____/___/\___/   \___/___/_/|_/___/___/___/___/ /_/

            A Terminal-Based Automotive RPG
              _______________
             //             \\
            //               \\
      _____//_________________\\______
     |  _  |||  _  ||  _  ||  _  |   |
     |_/ \_|||_/ \_||_/ \_||_/ \_|___|
      |_____|        |_____|
```

A terminal-based, open-world, automotive RPG survival game. Drive, fight,
loot, and survive in a procedurally generated wasteland controlled by rival
factions. Every playthrough is unique -- the world's theme, factions, and
quests are generated by a Large Language Model.

---

## Table of Contents

- [Features](#features)
- [Installation](#installation)
- [Running the Game](#running-the-game)
- [Controls](#controls)
- [World Generation Modes](#world-generation-modes)
- [Troubleshooting](#troubleshooting)

---

## Features

- **Infinite Procedural World** -- An endlessly generated map of roads,
  cities, and wilderness. No two playthroughs are the same.
- **Faction Warfare** -- The wasteland is carved up by rival factions.
  Align with one, play them against each other, or go rogue. Your actions
  shift territorial control, shop quality, and patrol strength.
- **Vehicles** -- A roster of cars including sports cars, sedans, trucks,
  monster trucks, motorcycles, hot rods, and SUVs, each with unique stats
  and attachment points.
- **Weapons and Equipment** -- Mount weapons to your car's hardpoints.
  Equip passive gear (armor, engine upgrades, tires, accessories) for stat
  bonuses. Weapons and equipment come in rarity tiers from common to
  legendary, with random modifiers.
- **Cities** -- Procedurally generated with gas stations, mechanic shops,
  weapon shops, and a city hall for faction quests.
- **Combat and Loot** -- Fight bandits and hostile vehicles. Defeated
  enemies drop weapons, equipment, ammo, and cash.
- **Resource Management** -- Manage durability, fuel, ammo, and cash.
  Repair at mechanics, refuel at gas stations, rearm at weapon shops.
- **Salvage System** -- Break down unwanted gear into scrap, a secondary
  currency.
- **LLM-Powered Narrative** -- The game's story, factions, and quests are
  generated fresh each playthrough by a language model. Play offline with
  a local model or online with Gemini for faster generation.

---

## Installation

### Prerequisites

- **Python 3.10+**
- **pip**
- A terminal with Unicode support (most modern terminals work)

### Quick Install

Clone the repository, then run the installer for your platform:

**macOS / Linux:**

```bash
git clone https://github.com/anthropics/LLMCarGame.git
cd LLMCarGame
chmod +x install.sh
./install.sh
```

**Windows:**

```
git clone https://github.com/anthropics/LLMCarGame.git
cd LLMCarGame
install.bat
```

The installer will:

1. Check for Python and pip
2. Create a virtual environment
3. Install all dependencies
4. Build `llama-cpp-python` with GPU acceleration if available
   (Metal on macOS, CUDA on Linux/Windows with NVIDIA GPU)
5. Optionally download the local AI model (~2GB)

If you skipped the model download during install, you can run it later:

```bash
python3 download_model.py
```

---

## Running the Game

**macOS / Linux:**

```bash
./run_game.sh
```

**Windows:**

```
run_game.bat
```

Optional flags (macOS/Linux):

- `./run_game.sh --dev` -- Enable Textual developer mode
- `./run_game.sh --log` -- Enable file logging

---

## Controls

### Driving

| Key             | Action                              |
|-----------------|-------------------------------------|
| `W`             | Accelerate                          |
| `S`             | Brake / Reverse                     |
| `A`             | Turn left                           |
| `D`             | Turn right                          |
| `Left Arrow`    | Aim weapons left                    |
| `Right Arrow`   | Aim weapons right                   |
| `Space`         | Fire weapons                        |
| `1`-`9`         | Toggle individual weapon mounts     |

### Menus and Screens

| Key             | Action                              |
|-----------------|-------------------------------------|
| `I` / `Tab`     | Open inventory                      |
| `M`             | Open map                            |
| `F`             | Open faction command screen         |
| `Q`             | Open quest log                      |
| `Esc`           | Pause menu                          |
| `Enter`         | Open notification log               |
| `` ` `` / `~`   | Debug console                       |

### Inventory Screen

| Key             | Action                              |
|-----------------|-------------------------------------|
| `Up` / `Down`   | Navigate items                      |
| `Left` / `Right`| Switch pane (Inventory / Loadout / Equipment) |
| `Enter`         | Equip or select item                |
| `S`             | Salvage item for scrap              |
| `A` / `D`       | Rotate car preview                  |
| `Esc`           | Back                                |

### Shop Screen

| Key             | Action                              |
|-----------------|-------------------------------------|
| `Up` / `Down`   | Navigate items                      |
| `Left` / `Right`| Switch between shop and your inventory |
| `Enter`         | Buy or sell selected item           |
| `Esc`           | Leave shop                          |

### Map Screen

| Key             | Action                              |
|-----------------|-------------------------------------|
| `W` / `S`       | Cycle through map nodes             |
| `Arrow Keys`    | Scroll map freely                   |
| `M`             | Toggle world map / city map         |
| `C`             | Center on player                    |
| `Enter`         | Set waypoint to selected node       |
| `Esc`           | Close map                           |

### Buildings

Drive slowly into a building to enter it. The car auto-stops on contact.
Gas stations, mechanic shops, weapon shops, and city halls are all entered
this way.

---

## World Generation Modes

The game offers two modes for generating its narrative content. Switch
between them in the **Settings** menu.

### Local Mode (Default)

Uses a local LLM running on your machine.

- Fully offline after initial model download
- Generation speed depends on your hardware (can be slow on older machines)
- Requires the ~2GB model file (downloaded during install or via
  `python3 download_model.py`)

### Gemini CLI Mode

Uses Google's Gemini API in the cloud.

- Fast generation (usually under 30 seconds)
- Higher quality narrative output
- Requires internet access and Gemini CLI setup

#### Setting Up Gemini CLI

**Option 1: User Authentication (recommended)**

1. Install the Gemini CLI per the
   [official instructions](https://ai.google.dev/tutorials/gemini_cli_quickstart)
2. Authenticate:
   ```bash
   gemini auth
   ```

**Option 2: API Key**

1. Get an API key from [Google AI Studio](https://aistudio.google.com/)
2. Set the environment variable:
   - macOS / Linux: `export GEMINI_API_KEY="YOUR_KEY"`
   - Windows: `set GEMINI_API_KEY="YOUR_KEY"`

Then launch the game, go to **Settings**, and set the generation mode
to "Gemini CLI".

---

## Troubleshooting

### Python not found

```
ERROR: python3 is not installed or not in PATH.
```

Install Python 3.10 or later:

| Platform | Command |
|----------|---------|
| macOS (Homebrew) | `brew install python3` |
| macOS (Xcode) | `xcode-select --install` |
| Debian / Ubuntu | `sudo apt install python3 python3-pip python3-venv` |
| Fedora | `sudo dnf install python3 python3-pip` |
| Arch | `sudo pacman -S python python-pip` |
| Windows | Download from [python.org](https://www.python.org/downloads/) -- check "Add Python to PATH" |
| Windows (winget) | `winget install Python.Python.3.12` |

### pip not found

```
ERROR: pip is not available for python3.
```

- macOS: `python3 -m ensurepip --upgrade`
- Debian/Ubuntu: `sudo apt install python3-pip`
- Windows: Reinstall Python with "pip" checked, or run
  `python3 -m ensurepip --upgrade`

### Virtual environment creation fails

```
ERROR: Failed to create virtual environment.
```

On Debian/Ubuntu, install the venv module:

```bash
sudo apt install python3-venv
```

### llama-cpp-python build fails

This package compiles C++ code and can fail if build tools are missing.

**macOS:**

```bash
xcode-select --install
```

**Debian / Ubuntu:**

```bash
sudo apt install build-essential cmake
```

**Windows:**

Install [Visual Studio Build Tools](https://visualstudio.microsoft.com/visual-cpp-build-tools/)
with the "Desktop development with C++" workload.

**CUDA build fails on Linux/Windows:**

If you have an NVIDIA GPU but the CUDA build fails, install the CUDA
toolkit:

- Linux: `sudo apt install nvidia-cuda-toolkit`
- Windows: Download from
  [NVIDIA CUDA Downloads](https://developer.nvidia.com/cuda-downloads)

The installer will automatically fall back to a CPU-only build if CUDA
compilation fails. The game will still work, but local AI generation
will be slower.

### Terminal rendering issues

- Use a terminal that supports Unicode and 256+ colors
- Recommended: iTerm2 (macOS), Windows Terminal (Windows),
  Alacritty, Kitty, or any modern terminal emulator
- Avoid older terminals like the default macOS Terminal.app or cmd.exe
- If colors look wrong, ensure your terminal's color scheme uses a dark
  background

### Game crashes on startup with `ModuleNotFoundError`

Make sure you ran the installer first:

- macOS / Linux: `./install.sh`
- Windows: `install.bat`

If you installed dependencies manually, ensure you activated the virtual
environment before running the game:

```bash
source venv/bin/activate   # macOS / Linux
venv\Scripts\activate.bat  # Windows
```

### Linux audio library error

If you see errors related to `libstdc++` on Linux, the run script
handles this automatically. If running manually, set:

```bash
export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libstdc++.so.6
python3 -m car
```
